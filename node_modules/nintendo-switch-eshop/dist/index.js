"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var Stream=_interopDefault(require("stream")),http=_interopDefault(require("http")),https=_interopDefault(require("https")),zlib=_interopDefault(require("zlib")),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var e,__assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __awaiter(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}!function(e){e.Parse="parse",e.Stringify="stringify"}(e||(e={}));var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e.toString():"";default:return""}},r=function(t,r){switch(r){case e.Parse:return{err:t};case e.Stringify:default:return t}},n=function(n,o){void 0===o&&(o={separator:"&",equals:"=",includeQuestion:!1});try{if(!n||Object.keys(n).length<=0)throw new Error("object_is_empty");if("object"!=typeof n)throw new Error("input_not_object");o.separator||(o.separator="&"),o.equals||(o.equals="="),o.includeQuestion||(o.includeQuestion=!1);var s=Object.keys(n).sort().map(function(e){var r=encodeURIComponent(t(e))+o.equals;return void 0===n[e]?"":null===n[e]?encodeURIComponent(e):Array.isArray(n[e])?n[e].map(function(e){return r+encodeURIComponent(t(e))}).join(o.separator):r+encodeURIComponent(t(n[e]))}).filter(Boolean);return o.includeQuestion&&(s[0]="?"+s[0]),s.join(o.separator)}catch(s){return/object_is_empty/i.test(s.toString())?(o.includeQuestion?"?":"")+encodeURIComponent(t(n)):/input_not_object/i.test(s.toString())?r("@Favware/Querystring: Your input was not an object. Please supply an object when using Stringify",e.Stringify):s}},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}function getCjsExportFromNamespace(e){return e&&e.default||e}var underscore=createCommonjsModule(function(e,t){(function(){var r=this,n=r._,o={},s=Array.prototype,i=Object.prototype,a=Function.prototype,u=s.push,c=s.slice,l=s.concat,h=i.toString,f=i.hasOwnProperty,p=s.forEach,d=s.map,m=s.reduce,g=s.reduceRight,y=s.filter,_=s.every,b=s.some,E=s.indexOf,v=s.lastIndexOf,A=Array.isArray,S=Object.keys,T=a.bind,C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};e.exports&&(t=e.exports=C),t._=C,C.VERSION="1.6.0";var N=C.each=C.forEach=function(e,t,r){if(null==e)return e;if(p&&e.forEach===p)e.forEach(t,r);else if(e.length===+e.length){for(var n=0,s=e.length;n<s;n++)if(t.call(r,e[n],n,e)===o)return}else{var i=C.keys(e);for(n=0,s=i.length;n<s;n++)if(t.call(r,e[i[n]],i[n],e)===o)return}return e};C.map=C.collect=function(e,t,r){var n=[];return null==e?n:d&&e.map===d?e.map(t,r):(N(e,function(e,o,s){n.push(t.call(r,e,o,s))}),n)};var w="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(e,t,r,n){var o=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return n&&(t=C.bind(t,n)),o?e.reduce(t,r):e.reduce(t);if(N(e,function(e,s,i){o?r=t.call(n,r,e,s,i):(r=e,o=!0)}),!o)throw new TypeError(w);return r},C.reduceRight=C.foldr=function(e,t,r,n){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return n&&(t=C.bind(t,n)),o?e.reduceRight(t,r):e.reduceRight(t);var s=e.length;if(s!==+s){var i=C.keys(e);s=i.length}if(N(e,function(a,u,c){u=i?i[--s]:--s,o?r=t.call(n,r,e[u],u,c):(r=e[u],o=!0)}),!o)throw new TypeError(w);return r},C.find=C.detect=function(e,t,r){var n;return P(e,function(e,o,s){if(t.call(r,e,o,s))return n=e,!0}),n},C.filter=C.select=function(e,t,r){var n=[];return null==e?n:y&&e.filter===y?e.filter(t,r):(N(e,function(e,o,s){t.call(r,e,o,s)&&n.push(e)}),n)},C.reject=function(e,t,r){return C.filter(e,function(e,n,o){return!t.call(r,e,n,o)},r)},C.every=C.all=function(e,t,r){t||(t=C.identity);var n=!0;return null==e?n:_&&e.every===_?e.every(t,r):(N(e,function(e,s,i){if(!(n=n&&t.call(r,e,s,i)))return o}),!!n)};var P=C.some=C.any=function(e,t,r){t||(t=C.identity);var n=!1;return null==e?n:b&&e.some===b?e.some(t,r):(N(e,function(e,s,i){if(n||(n=t.call(r,e,s,i)))return o}),!!n)};C.contains=C.include=function(e,t){return null!=e&&(E&&e.indexOf===E?-1!=e.indexOf(t):P(e,function(e){return e===t}))},C.invoke=function(e,t){var r=c.call(arguments,2),n=C.isFunction(t);return C.map(e,function(e){return(n?t:e[t]).apply(e,r)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matches(t))},C.findWhere=function(e,t){return C.find(e,C.matches(t))},C.max=function(e,t,r){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var n=-1/0,o=-1/0;return N(e,function(e,s,i){var a=t?t.call(r,e,s,i):e;a>o&&(n=e,o=a)}),n},C.min=function(e,t,r){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var n=1/0,o=1/0;return N(e,function(e,s,i){var a=t?t.call(r,e,s,i):e;a<o&&(n=e,o=a)}),n},C.shuffle=function(e){var t,r=0,n=[];return N(e,function(e){t=C.random(r++),n[r-1]=n[t],n[t]=e}),n},C.sample=function(e,t,r){return null==t||r?(e.length!==+e.length&&(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,Math.max(0,t))};var O=function(e){return null==e?C.identity:C.isFunction(e)?e:C.property(e)};C.sortBy=function(e,t,r){return t=O(t),C.pluck(C.map(e,function(e,n,o){return{value:e,index:n,criteria:t.call(r,e,n,o)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")};var x=function(e){return function(t,r,n){var o={};return r=O(r),N(t,function(s,i){var a=r.call(n,s,i,t);e(o,a,s)}),o}};C.groupBy=x(function(e,t,r){C.has(e,t)?e[t].push(r):e[t]=[r]}),C.indexBy=x(function(e,t,r){e[t]=r}),C.countBy=x(function(e,t){C.has(e,t)?e[t]++:e[t]=1}),C.sortedIndex=function(e,t,r,n){for(var o=(r=O(r)).call(n,t),s=0,i=e.length;s<i;){var a=s+i>>>1;r.call(n,e[a])<o?s=a+1:i=a}return s},C.toArray=function(e){return e?C.isArray(e)?c.call(e):e.length===+e.length?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:e.length===+e.length?e.length:C.keys(e).length},C.first=C.head=C.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:t<0?[]:c.call(e,0,t)},C.initial=function(e,t,r){return c.call(e,0,e.length-(null==t||r?1:t))},C.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:c.call(e,Math.max(e.length-t,0))},C.rest=C.tail=C.drop=function(e,t,r){return c.call(e,null==t||r?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var R=function(e,t,r){return t&&C.every(e,C.isArray)?l.apply(r,e):(N(e,function(e){C.isArray(e)||C.isArguments(e)?t?u.apply(r,e):R(e,t,r):r.push(e)}),r)};C.flatten=function(e,t){return R(e,t,[])},C.without=function(e){return C.difference(e,c.call(arguments,1))},C.partition=function(e,t){var r=[],n=[];return N(e,function(e){(t(e)?r:n).push(e)}),[r,n]},C.uniq=C.unique=function(e,t,r,n){C.isFunction(t)&&(n=r,r=t,t=!1);var o=r?C.map(e,r,n):e,s=[],i=[];return N(o,function(r,n){(t?n&&i[i.length-1]===r:C.contains(i,r))||(i.push(r),s.push(e[n]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(e){var t=c.call(arguments,1);return C.filter(C.uniq(e),function(e){return C.every(t,function(t){return C.contains(t,e)})})},C.difference=function(e){var t=l.apply(s,c.call(arguments,1));return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){for(var e=C.max(C.pluck(arguments,"length").concat(0)),t=new Array(e),r=0;r<e;r++)t[r]=C.pluck(arguments,""+r);return t},C.object=function(e,t){if(null==e)return{};for(var r={},n=0,o=e.length;n<o;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},C.indexOf=function(e,t,r){if(null==e)return-1;var n=0,o=e.length;if(r){if("number"!=typeof r)return e[n=C.sortedIndex(e,t)]===t?n:-1;n=r<0?Math.max(0,o+r):r}if(E&&e.indexOf===E)return e.indexOf(t,r);for(;n<o;n++)if(e[n]===t)return n;return-1},C.lastIndexOf=function(e,t,r){if(null==e)return-1;var n=null!=r;if(v&&e.lastIndexOf===v)return n?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var o=n?r:e.length;o--;)if(e[o]===t)return o;return-1},C.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/r),0),o=0,s=new Array(n);o<n;)s[o++]=e,e+=r;return s};var I=function(){};C.bind=function(e,t){var r,n;if(T&&e.bind===T)return T.apply(e,c.call(arguments,1));if(!C.isFunction(e))throw new TypeError;return r=c.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(c.call(arguments)));I.prototype=e.prototype;var o=new I;I.prototype=null;var s=e.apply(o,r.concat(c.call(arguments)));return Object(s)===s?s:o}},C.partial=function(e){var t=c.call(arguments,1);return function(){for(var r=0,n=t.slice(),o=0,s=n.length;o<s;o++)n[o]===C&&(n[o]=arguments[r++]);for(;r<arguments.length;)n.push(arguments[r++]);return e.apply(this,n)}},C.bindAll=function(e){var t=c.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return N(t,function(t){e[t]=C.bind(e[t],e)}),e},C.memoize=function(e,t){var r={};return t||(t=C.identity),function(){var n=t.apply(this,arguments);return C.has(r,n)?r[n]:r[n]=e.apply(this,arguments)}},C.delay=function(e,t){var r=c.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},C.defer=function(e){return C.delay.apply(C,[e,1].concat(c.call(arguments,1)))},C.throttle=function(e,t,r){var n,o,s,i=null,a=0;r||(r={});var u=function(){a=!1===r.leading?0:C.now(),i=null,s=e.apply(n,o),n=o=null};return function(){var c=C.now();a||!1!==r.leading||(a=c);var l=t-(c-a);return n=this,o=arguments,l<=0?(clearTimeout(i),i=null,a=c,s=e.apply(n,o),n=o=null):i||!1===r.trailing||(i=setTimeout(u,l)),s}},C.debounce=function(e,t,r){var n,o,s,i,a,u=function(){var c=C.now()-i;c<t?n=setTimeout(u,t-c):(n=null,r||(a=e.apply(s,o),s=o=null))};return function(){s=this,o=arguments,i=C.now();var c=r&&!n;return n||(n=setTimeout(u,t)),c&&(a=e.apply(s,o),s=o=null),a}},C.once=function(e){var t,r=!1;return function(){return r?t:(r=!0,t=e.apply(this,arguments),e=null,t)}},C.wrap=function(e,t){return C.partial(t,e)},C.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},C.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},C.keys=function(e){if(!C.isObject(e))return[];if(S)return S(e);var t=[];for(var r in e)C.has(e,r)&&t.push(r);return t},C.values=function(e){for(var t=C.keys(e),r=t.length,n=new Array(r),o=0;o<r;o++)n[o]=e[t[o]];return n},C.pairs=function(e){for(var t=C.keys(e),r=t.length,n=new Array(r),o=0;o<r;o++)n[o]=[t[o],e[t[o]]];return n},C.invert=function(e){for(var t={},r=C.keys(e),n=0,o=r.length;n<o;n++)t[e[r[n]]]=r[n];return t},C.functions=C.methods=function(e){var t=[];for(var r in e)C.isFunction(e[r])&&t.push(r);return t.sort()},C.extend=function(e){return N(c.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e},C.pick=function(e){var t={},r=l.apply(s,c.call(arguments,1));return N(r,function(r){r in e&&(t[r]=e[r])}),t},C.omit=function(e){var t={},r=l.apply(s,c.call(arguments,1));for(var n in e)C.contains(r,n)||(t[n]=e[n]);return t},C.defaults=function(e){return N(c.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e};var M=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var o=h.call(e);if(o!=h.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=r.length;s--;)if(r[s]==e)return n[s]==t;var i=e.constructor,a=t.constructor;if(i!==a&&!(C.isFunction(i)&&i instanceof i&&C.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1;r.push(e),n.push(t);var u=0,c=!0;if("[object Array]"==o){if(c=(u=e.length)==t.length)for(;u--&&(c=M(e[u],t[u],r,n)););}else{for(var l in e)if(C.has(e,l)&&(u++,!(c=C.has(t,l)&&M(e[l],t[l],r,n))))break;if(c){for(l in t)if(C.has(t,l)&&!u--)break;c=!u}}return r.pop(),n.pop(),c};C.isEqual=function(e,t){return M(e,t,[],[])},C.isEmpty=function(e){if(null==e)return!0;if(C.isArray(e)||C.isString(e))return 0===e.length;for(var t in e)if(C.has(e,t))return!1;return!0},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=A||function(e){return"[object Array]"==h.call(e)},C.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){C["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return!(!e||!C.has(e,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(e){return"function"==typeof e}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!=+e},C.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==h.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return f.call(e,t)},C.noConflict=function(){return r._=n,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.property=function(e){return function(t){return t[e]}},C.matches=function(e){return function(t){if(t===e)return!0;for(var r in e)if(e[r]!==t[r])return!1;return!0}},C.times=function(e,t,r){for(var n=Array(Math.max(0,e)),o=0;o<e;o++)n[o]=t.call(r,o);return n},C.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},C.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=C.invert(G.escape);var j={escape:new RegExp("["+C.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(G.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(e){C[e]=function(t){return null==t?"":(""+t).replace(j[e],function(t){return G[e][t]})}}),C.result=function(e,t){if(null!=e){var r=e[t];return C.isFunction(r)?r.call(e):r}},C.mixin=function(e){N(C.functions(e),function(t){var r=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),$.call(this,r.apply(C,e))}})};var U=0;C.uniqueId=function(e){var t=++U+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(e,t,r){var n;r=C.defaults({},r,C.templateSettings);var o=new RegExp([(r.escape||L).source,(r.interpolate||L).source,(r.evaluate||L).source].join("|")+"|$","g"),s=0,i="__p+='";e.replace(o,function(t,r,n,o,a){return i+=e.slice(s,a).replace(B,function(e){return"\\"+D[e]}),r&&(i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(i+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(i+="';\n"+o+"\n__p+='"),s=a+t.length,t}),i+="';\n",r.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{n=new Function(r.variable||"obj","_",i)}catch(e){throw e.source=i,e}if(t)return n(t,C);var a=function(e){return n.call(this,e,C)};return a.source="function("+(r.variable||"obj")+"){\n"+i+"}",a},C.chain=function(e){return C(e).chain()};var $=function(e){return this._chain?C(e).chain():e};C.mixin(C),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];C.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],$.call(this,r)}}),N(["concat","join","slice"],function(e){var t=s[e];C.prototype[e]=function(){return $.call(this,t.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(commonjsGlobal)}),underscore_1=underscore._,regions={centralAsia:{name:"Central Asia",countries:["KZ","KG","TJ","TM","UZ"]},southernAsia:{name:"Southern Asia",countries:["AF","BD","BT","IO","IN","IR","MV","NP","PK","LK"]},southeastAsia:{name:"Southeast Asia",countries:["BN","KH","CX","CC","TL","ID","LA","MY","MM","PH","SG","TH","VN"]},eastAsia:{name:"East Asia",countries:["CN","HK","JP","KP","KR","MO","MN","TW"]},westernAsia:{name:"Western Asia",countries:["AM","AZ","BH","IQ","IL","JO","KW","LB","OM","PS","QA","SA","SY","TR","AE","YE"]},centralAfrica:{name:"Central Aftrica",countries:["AO","CM","CF","TD","CG","CD","GQ","GA","ST"]},northAfrica:{name:"North Africa",countries:["DZ","EG","LY","MA","SD","TN","EH"]},southernAfrica:{name:"Southern Africa",countries:["BW","LS","NA","ZA","SZ"]},eastAfrica:{name:"East Africa",countries:["BI","KM","DJ","ER","ET","KE","MG","MW","MU","YT","MZ","RE","RW","SC","SO","SS","TZ","UG","ZM","ZW"]},westAfrica:{name:"West Africa",countries:["BJ","BF","CV","CI","GM","GH","GN","GW","LR","ML","MR","NE","NG","SH","SN","SL","TG"]},centralAmerica:{name:"Central America",countries:["BZ","CR","SV","GT","HN","NI","PA"]},northernAmerica:{name:"Northern America",countries:["BM","CA","GL","MX","PM","US"]},caribbean:{name:"Caribbean",countries:["AI","AG","AW","BS","BB","BQ","VG","KY","CU","CW","DM","DO","GD","GP","HT","JM","MQ","MS","PR","BL","KN","LC","MF","VC","SX","TT","TC","VI"]},southAmerica:{name:"South America",countries:["AR","BO","BR","CL","CO","EC","FK","GF","GY","PY","PE","SR","UY","VE"]},antartica:{name:"Antartica",countries:["AQ","BV","TF","HM","GS"]},northernEurope:{name:"Northern Europe",countries:["AX","DK","EE","FO","FI","GG","IS","IE","JE","IM","LV","LT","NO","SJ","SE","GB"]},southernEurope:{name:"Southern Europe",countries:["AL","AD","BA","HR","CY","GI","GR","IT","MK","VA","MT","ME","PT","SM","RS","SI","ES"]},easternEurope:{name:"Eastern Europe",countries:["BY","BG","CZ","GE","HU","MD","PL","RO","RU","SK","UA"]},westernEurope:{name:"Western Europe",countries:["AT","BE","FR","DE","LI","LU","MC","NL","CH"]},australia:{name:"Australia",countries:["AU","NF","NZ"]},melanesia:{name:"Melanesia",countries:["FJ","NC","PG","SB","VU"]},micronesia:{name:"Micronesia",countries:["GU","KI","MH","FM","NR","MP","PW","UM"]},polynesia:{name:"Polynesia",countries:["AS","CK","PF","NU","PN","WS","TK","TO","TV","WF"]}},regions_1=regions,continents={};continents.asia={name:"Asia",regions:["centralAsia","southernAsia","southeastAsia","eastAsia","westernAsia"],countries:underscore.flatten([regions_1.centralAsia.countries,regions_1.southernAsia.countries,regions_1.southeastAsia.countries,regions_1.eastAsia.countries,regions_1.westernAsia.countries]).sort()},continents.africa={name:"Africa",regions:["centralAfrica","northAfrica","southernAfrica","eastAfrica","westAfrica"],countries:underscore.flatten([regions_1.centralAfrica.countries,regions_1.northAfrica.countries,regions_1.southernAfrica.countries,regions_1.eastAfrica.countries,regions_1.westAfrica.countries]).sort()},continents.northAmerica={name:"North America",regions:["centralAmerica","northernAmerica","caribbean"],countries:underscore.flatten([regions_1.centralAmerica.countries,regions_1.northernAmerica.countries,regions_1.caribbean.countries]).sort()},continents.southAmerica={name:"South America",regions:["southAmerica"],countries:underscore.flatten([regions_1.southAmerica.countries]).sort()},continents.antartica={name:"Antartica",regions:["antartica"],countries:underscore.flatten([regions_1.antartica.countries]).sort()},continents.europe={name:"Europe",regions:["northernEurope","southernEurope","easternEurope","westernEurope"],countries:underscore.flatten([regions_1.northernEurope.countries,regions_1.southernEurope.countries,regions_1.easternEurope.countries,regions_1.westernEurope.countries]).sort()},continents.oceania={name:"Oceania",regions:["australia","melanesia","micronesia","polynesia"],countries:underscore.flatten([regions_1.australia.countries,regions_1.melanesia.countries,regions_1.micronesia.countries,regions_1.polynesia.countries]).sort()};var continents_1=continents,countries=Object.freeze({}),currencies=Object.freeze({}),languages=Object.freeze({}),lookup=init;function init(e){return{countries:search.bind(null,e.countries),currencies:search.bind(null,e.currencies),languages:search.bind(null,e.languages)}}function search(e,t){var r=underscore.pairs(t);return e.filter(function(e){return r.filter(function(t){var r=e[t[0]];return underscore.isArray(r)?r.indexOf(t[1])>=0:r==t[1]}).length==r.length})}var map={ALL:"L",AFN:"؋",ARS:"$",AWG:"ƒ",AUD:"$",AZN:"₼",BSD:"$",BBD:"$",BYR:"p.",BZD:"BZ$",BMD:"$",BOB:"Bs.",BAM:"KM",BWP:"P",BGN:"лв",BRL:"R$",BND:"$",KHR:"៛",CAD:"$",KYD:"$",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",HRK:"kn",CUP:"₱",CZK:"Kč",DKK:"kr",DOP:"RD$",XCD:"$",EGP:"£",SVC:"$",EEK:"kr",EUR:"€",FKP:"£",FJD:"$",GHC:"¢",GIP:"£",GTQ:"Q",GGP:"£",GYD:"$",HNL:"L",HKD:"$",HUF:"Ft",ISK:"kr",INR:"₹",IDR:"Rp",IRR:"﷼",IMP:"£",ILS:"₪",JMD:"J$",JPY:"¥",JEP:"£",KES:"KSh",KZT:"лв",KPW:"₩",KRW:"₩",KGS:"лв",LAK:"₭",LVL:"Ls",LBP:"£",LRD:"$",LTL:"Lt",MKD:"ден",MYR:"RM",MUR:"₨",MXN:"$",MNT:"₮",MZN:"MT",NAD:"$",NPR:"₨",ANG:"ƒ",NZD:"$",NIO:"C$",NGN:"₦",NOK:"kr",OMR:"﷼",PKR:"₨",PAB:"B/.",PYG:"Gs",PEN:"S/.",PHP:"₱",PLN:"zł",QAR:"﷼",RON:"lei",RUB:"₽",SHP:"£",SAR:"﷼",RSD:"Дин.",SCR:"₨",SGD:"$",SBD:"$",SOS:"S",ZAR:"R",LKR:"₨",SEK:"kr",CHF:"CHF",SRD:"$",SYP:"£",TZS:"TSh",TWD:"NT$",THB:"฿",TTD:"TT$",TRY:"",TRL:"₤",TVD:"$",UGX:"USh",UAH:"₴",GBP:"£",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",YER:"﷼",ZWD:"Z$"},currencySymbolMap=mapSymbol;function mapSymbol(e){return map.hasOwnProperty(e)?map[e]:"?"}var countriesAll=getCjsExportFromNamespace(countries),currenciesAll=getCjsExportFromNamespace(currencies),languagesAll=getCjsExportFromNamespace(languages),countryData=createCommonjsModule(function(e,t){t.continents=continents_1,t.regions=regions_1,t.countries={all:countriesAll},underscore.each(countriesAll,function(e){var r=t.countries[e.alpha2];r&&"deleted"!==r.status||(t.countries[e.alpha2]=e);var n=t.countries[e.alpha3];n&&"deleted"!==n.status||(t.countries[e.alpha3]=e)}),t.currencies={all:currenciesAll},underscore.each(currenciesAll,function(e){var r=currencySymbolMap(e.code);"?"==r&&(r=e.code),e.symbol=r,t.currencies[e.code]=e}),t.languages={all:languagesAll},underscore.each(languagesAll,function(e){t.languages[e.alpha2]=e,t.languages[e.bibliographic]=e,t.languages[e.alpha3]=e}),t.lookup=lookup({countries:countriesAll,currencies:currenciesAll,languages:languagesAll});var r={all:[]},n=underscore.reduce(countriesAll,function(e,t){return t.countryCallingCodes&&t.countryCallingCodes.length&&(r.all.push(t),r[t.alpha2]=t,r[t.alpha3]=t,underscore.each(t.countryCallingCodes,function(t){-1==e.indexOf(t)&&e.push(t)})),e},[]);delete r[""],t.callingCountries=r,n.sort(function(e,t){var r=function(e){return parseInt(e)},n=underscore.map(e.split(" "),r),o=underscore.map(t.split(" "),r);return n[0]<o[0]?-1:n[0]>o[0]?1:void 0===n[1]&&void 0!==o[1]?-1:void 0!==n[1]&&void 0===o[1]?1:n[1]<o[1]?-1:n[1]>o[1]?1:0}),t.callingCodes={all:n}}),countryData_1=countryData.continents,countryData_2=countryData.regions,countryData_3=countryData.countries,countryData_4=countryData.currencies,countryData_5=countryData.languages,countryData_6=countryData.lookup,countryData_7=countryData.callingCountries,countryData_8=countryData.callingCodes,util=createCommonjsModule(function(e,t){const r=function(e,t){const r=t.exec(e);return!(null==r)};t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t){if(t){const r=Object.keys(t),n=r.length;for(let o=0;o<n;o++)e[r[o]]=t[r[o]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.buildOptions=function(e,t,r){var n={};if(!e)return t;for(let o=0;o<r.length;o++)void 0!==e[r[o]]?n[r[o]]=e[r[o]]:n[r[o]]=t[r[o]];return n},t.doesMatch=r,t.doesNotMatch=function(e,t){return!r(e,t)},t.getAllMatches=function(e,t){const r=[];let n=t.exec(e);for(;n;){const o=[],s=n.length;for(let e=0;e<s;e++)o.push(n[e]);r.push(o),n=t.exec(e)}return r}}),util_1=util.isExist,util_2=util.isEmptyObject,util_3=util.merge,util_4=util.getValue,util_5=util.buildOptions,util_6=util.doesMatch,util_7=util.doesNotMatch,util_8=util.getAllMatches;const convertToJson=function(e,t){const r={};if(!(e.child&&!util.isEmptyObject(e.child)||e.attrsMap&&!util.isEmptyObject(e.attrsMap)))return util.isExist(e.val)?e.val:"";util.isExist(e.val)&&("string"!=typeof e.val||""!==e.val&&e.val!==t.cdataPositionChar)&&(r[t.textNodeName]=e.val),util.merge(r,e.attrsMap);const n=Object.keys(e.child);for(let i=0;i<n.length;i++){var o=n[i];if(e.child[o]&&e.child[o].length>1)for(var s in r[o]=[],e.child[o])r[o].push(convertToJson(e.child[o][s],t));else r[o]=convertToJson(e.child[o][0],t)}return r};var convertToJson_1=convertToJson,node2json={convertToJson:convertToJson_1},xmlNode=function(e,t,r){this.tagname=e,this.parent=t,this.child={},this.attrsMap={},this.val=r,this.addChild=function(e){Array.isArray(this.child[e.tagname])?this.child[e.tagname].push(e):this.child[e.tagname]=[e]}};const buildOptions=util.buildOptions,TagType={OPENING:1,CLOSING:2,SELF:3,CDATA:4},attrstr_regex="((\\s*[\\w\\-._:]+(=(('([^']*)')|(\"([^\"]*)\")))?)*)\\s*";let regx="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|(([\\w:\\-._]*:)?([\\w:\\-._]+))"+attrstr_regex+"(\\/)?>|((\\/)(([\\w:\\-._]*:)?([\\w:\\-._]+))\\s*>))([^<]*)";!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const defaultOptions={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",localeRange:"",tagValueProcessor:function(e){return e},attrValueProcessor:function(e){return e},stopNodes:[]};var defaultOptions_1=defaultOptions;const props=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","localeRange","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","stopNodes"];var props_1=props;const getTraversalObj=function(e,t){t=buildOptions(t,defaultOptions,props),e=e.replace(/<!--[\s\S]*?-->/g,"");const r=new xmlNode("!xml");let n=r;regx=regx.replace(/\[\\w/g,"["+t.localeRange+"\\w");const o=new RegExp(regx,"g");let s=o.exec(e),i=o.exec(e);for(;s;){const r=checkForTagType(s);if(r===TagType.CLOSING)n.parent&&s[22]&&(n.parent.val=util.getValue(n.parent.val)+""+processTagValue(s[22],t)),t.stopNodes.length&&t.stopNodes.includes(n.tagname)&&(n.child=[],null==n.attrsMap&&(n.attrsMap={}),n.val=e.substr(n.startIndex+1,s.index-n.startIndex-1)),n=n.parent;else if(r===TagType.CDATA)if(t.cdataTagName){const e=new xmlNode(t.cdataTagName,n,s[3]);e.attrsMap=buildAttributesMap(s[8],t),n.addChild(e),n.val=util.getValue(n.val)+t.cdataPositionChar,s[22]&&(n.val+=processTagValue(s[22],t))}else n.val=(n.val||"")+(s[3]||"")+processTagValue(s[22],t);else if(r===TagType.SELF){n&&s[22]&&(n.val=util.getValue(n.val)+""+processTagValue(s[22],t));const e=new xmlNode(t.ignoreNameSpace?s[7]:s[5],n,"");e.attrsMap=buildAttributesMap(s[8],t),n.addChild(e)}else{const e=new xmlNode(t.ignoreNameSpace?s[7]:s[5],n,processTagValue(s[22],t));t.stopNodes.length&&t.stopNodes.includes(e.tagname)&&(e.startIndex=s.index+s[1].length),e.attrsMap=buildAttributesMap(s[8],t),n.addChild(e),n=e}s=i,i=o.exec(e)}return r};function processTagValue(e,t){return e&&(t.trimValues&&(e=e.trim()),e=parseValue(e=t.tagValueProcessor(e),t.parseNodeValue,t.parseTrueNumberOnly)),e}function checkForTagType(e){return"]]>"===e[4]?TagType.CDATA:"/"===e[18]?TagType.CLOSING:"/"===e[16]?TagType.SELF:TagType.OPENING}function resolveNameSpace(e,t){if(t.ignoreNameSpace){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}function parseValue(e,t,r){if(t&&"string"==typeof e){let t;return""===e.trim()||isNaN(e)?t="true"===e||"false"!==e&&e:(t=-1!==e.indexOf("0x")?Number.parseInt(e,16):-1!==e.indexOf(".")?Number.parseFloat(e):Number.parseInt(e,10),r&&(t=String(t)===e?t:e)),t}return util.isExist(e)?e:""}const attrsRegx=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function buildAttributesMap(e,t){if(!t.ignoreAttributes&&"string"==typeof e){e=e.replace(/\r?\n/g," ");const r=util.getAllMatches(e,attrsRegx),n=r.length,o={};for(let e=0;e<n;e++){const n=resolveNameSpace(r[e][1],t);n.length&&(void 0!==r[e][4]?(t.trimValues&&(r[e][4]=r[e][4].trim()),r[e][4]=t.attrValueProcessor(r[e][4]),o[t.attributeNamePrefix+n]=parseValue(r[e][4],t.parseAttributeValue,t.parseTrueNumberOnly)):t.allowBooleanAttributes&&(o[t.attributeNamePrefix+n]=!0))}if(!Object.keys(o).length)return;if(t.attrNodeName){const e={};return e[t.attrNodeName]=o,e}return o}}var getTraversalObj_1=getTraversalObj,xmlstr2xmlnode={defaultOptions:defaultOptions_1,props:props_1,getTraversalObj:getTraversalObj_1};const char=function(e){return String.fromCharCode(e)},chars={nilChar:char(176),missingChar:char(201),nilPremitive:char(175),missingPremitive:char(200),emptyChar:char(178),emptyValue:char(177),boundryChar:char(179),objStart:char(198),arrStart:char(204),arrayEnd:char(185)},charsArr=[chars.nilChar,chars.nilPremitive,chars.missingChar,chars.missingPremitive,chars.boundryChar,chars.emptyChar,chars.emptyValue,chars.arrayEnd,chars.objStart,chars.arrStart],_e=function(e,t,r){if("string"==typeof t)return e&&e[0]&&void 0!==e[0].val?getValue(e[0].val):getValue(e);{const n=hasData(e);if(!0===n){let n="";if(Array.isArray(t)){n+=chars.arrStart;const o=t[0],s=e.length;if("string"==typeof o)for(let t=0;t<s;t++){const r=getValue(e[t].val);n=processValue(n,r)}else for(let t=0;t<s;t++){const s=_e(e[t],o,r);n=processValue(n,s)}n+=chars.arrayEnd}else{n+=chars.objStart;const o=Object.keys(t);Array.isArray(e)&&(e=e[0]);for(let s in o){const i=o[s];let a;a=!r.ignoreAttributes&&e.attrsMap&&e.attrsMap[i]?_e(e.attrsMap[i],t[i],r):i===r.textNodeName?_e(e.val,t[i],r):_e(e.child[i],t[i],r),n=processValue(n,a)}}return n}return n}},getValue=function(e){switch(e){case void 0:return chars.missingPremitive;case null:return chars.nilPremitive;case"":return chars.emptyValue;default:return e}},processValue=function(e,t){return isAppChar(t[0])||isAppChar(e[e.length-1])||(e+=chars.boundryChar),e+t},isAppChar=function(e){return-1!==charsArr.indexOf(e)};function hasData(e){return void 0===e?chars.missingChar:null===e?chars.nilChar:!(e.child&&0===Object.keys(e.child).length&&(!e.attrsMap||0===Object.keys(e.attrsMap).length))||chars.emptyChar}const buildOptions$1=util.buildOptions,convert2nimn=function(e,t,r){return r=buildOptions$1(r,xmlstr2xmlnode.defaultOptions,xmlstr2xmlnode.props),_e(e,t,r)};var convert2nimn_1=convert2nimn,nimndata={convert2nimn:convert2nimn_1};const buildOptions$2=util.buildOptions,convertToJsonString=function(e,t){return(t=buildOptions$2(t,xmlstr2xmlnode.defaultOptions,xmlstr2xmlnode.props)).indentBy=t.indentBy||"",_cToJsonStr(e,t)},_cToJsonStr=function(e,t,r){let n="{";const o=Object.keys(e.child);for(let r=0;r<o.length;r++){var s=o[r];if(e.child[s]&&e.child[s].length>1){for(var i in n+='"'+s+'" : [ ',e.child[s])n+=_cToJsonStr(e.child[s][i],t)+" , ";n=n.substr(0,n.length-1)+" ] "}else n+='"'+s+'" : '+_cToJsonStr(e.child[s][0],t)+" ,"}return util.merge(n,e.attrsMap),util.isEmptyObject(n)?util.isExist(e.val)?e.val:"":(util.isExist(e.val)&&("string"!=typeof e.val||""!==e.val&&e.val!==t.cdataPositionChar)&&(n+='"'+t.textNodeName+'" : '+stringval(e.val)),","===n[n.length-1]&&(n=n.substr(0,n.length-2)),n+"}")};function stringval(e){return!0!==e&&!1!==e&&isNaN(e)?'"'+e+'"':e}var convertToJsonString_1=convertToJsonString,node2json_str={convertToJsonString:convertToJsonString_1};const defaultOptions$1={allowBooleanAttributes:!1,localeRange:"a-zA-Z"},props$1=["allowBooleanAttributes","localeRange"];var validate=function(e,t){t=util.buildOptions(t,defaultOptions$1,props$1);const r=[];let n=!1;"\ufeff"===e[0]&&(e=e.substr(1));const o=new RegExp("^[_w][\\w\\-.:]*$".replace("_w","_"+t.localeRange)),s=new RegExp("^([w]|_)[\\w.\\-_:]*".replace("([w","(["+t.localeRange));for(let i=0;i<e.length;i++){if("<"!==e[i]){if(" "===e[i]||"\t"===e[i]||"\n"===e[i]||"\r"===e[i])continue;return{err:{code:"InvalidChar",msg:"char "+e[i]+" is not expected ."}}}if("?"===e[++i]){if((i=readPI(e,++i)).err)return i}else{if("!"===e[i]){i=readCommentAndCDATA(e,i);continue}{let a=!1;"/"===e[i]&&(a=!0,i++);let u="";for(;i<e.length&&">"!==e[i]&&" "!==e[i]&&"\t"!==e[i]&&"\n"!==e[i]&&"\r"!==e[i];i++)u+=e[i];if("/"===(u=u.trim())[u.length-1]){u=u.substring(0,u.length-1);continue}if(!validateTagName(u,s))return{err:{code:"InvalidTag",msg:"Tag "+u+" is an invalid name."}};const c=readAttributeStr(e,i);if(!1===c)return{err:{code:"InvalidAttr",msg:"Attributes for "+u+" have open quote"}};let l=c.value;if(i=c.index,"/"===l[l.length-1]){const e=validateAttributeString(l=l.substring(0,l.length-1),t,o);if(!0!==e)return e;n=!0}else if(a){if(l.trim().length>0)return{err:{code:"InvalidTag",msg:"closing tag "+u+" can't have attributes or invalid starting."}};{const e=r.pop();if(u!==e)return{err:{code:"InvalidTag",msg:"closing tag "+e+" is expected inplace of "+u+"."}}}}else{const e=validateAttributeString(l,t,o);if(!0!==e)return e;r.push(u),n=!0}for(i++;i<e.length;i++)if("<"===e[i]){if("!"===e[i+1]){i=readCommentAndCDATA(e,++i);continue}break}"<"===e[i]&&i--}}}return n?!(r.length>0)||{err:{code:"InvalidXml",msg:"Invalid "+JSON.stringify(r,null,4).replace(/\r?\n/g,"")+" found."}}:{err:{code:"InvalidXml",msg:"Start tag expected."}}};function readPI(e,t){for(var r=t;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{var n=e.substr(r,t-r);if(t>5&&"xml"===n)return{err:{code:"InvalidXml",msg:"XML declaration allowed only at the start of the document."}};if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function readCommentAndCDATA(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&0===--r)break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}var doubleQuote='"',singleQuote="'";function readAttributeStr(e,t){let r="",n="";for(;t<e.length;t++){if(e[t]===doubleQuote||e[t]===singleQuote)if(""===n)n=e[t];else{if(n!==e[t])continue;n=""}else if(">"===e[t]&&""===n)break;r+=e[t]}return""===n&&{value:r,index:t}}const validAttrStrRegxp=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function validateAttributeString(e,t,r){const n=util.getAllMatches(e,validAttrStrRegxp),o={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return{err:{code:"InvalidAttr",msg:"attribute "+n[e][2]+" has no space in starting."}};if(void 0===n[e][3]&&!t.allowBooleanAttributes)return{err:{code:"InvalidAttr",msg:"boolean attribute "+n[e][2]+" is not allowed."}};const s=n[e][2];if(!validateAttrName(s,r))return{err:{code:"InvalidAttr",msg:"attribute "+s+" is an invalid name."}};if(o.hasOwnProperty(s))return{err:{code:"InvalidAttr",msg:"attribute "+s+" is repeated."}};o[s]=1}return!0}function validateAttrName(e,t){return util.doesMatch(e,t)}function validateTagName(e,t){return!util.doesNotMatch(e,t)}var validator={validate:validate};const buildOptions$3=util.buildOptions,defaultOptions$2={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(e){return e},attrValueProcessor:function(e){return e}},props$2=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor"];function Parser(e){this.options=buildOptions$3(e,defaultOptions$2,props$2),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=isAttribute),this.options.cdataTagName?this.isCDATA=isCDATA:this.isCDATA=function(){return!1},this.replaceCDATAstr=replaceCDATAstr,this.replaceCDATAarr=replaceCDATAarr,this.options.format?(this.indentate=indentate,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=buildEmptyTextNode,this.buildObjNode=buildEmptyObjNode):(this.buildTextNode=buildTextValNode,this.buildObjNode=buildObjectNode),this.buildTextValNode=buildTextValNode,this.buildObjectNode=buildObjectNode}function replaceCDATAstr(e,t){return e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e?e+"<![CDATA["+t+"]]"+this.tagEndChar:e.replace(this.options.cdataPositionChar,"<![CDATA["+t+"]]"+this.tagEndChar)}function replaceCDATAarr(e,t){if(e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e)return e+"<![CDATA["+t.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let r in t)e=e.replace(this.options.cdataPositionChar,"<![CDATA["+t[r]+"]]>");return e+this.newLine}function buildObjectNode(e,t,r,n){return r&&!e.includes("<")?this.indentate(n)+"<"+t+r+">"+e+"</"+t+this.tagEndChar:this.indentate(n)+"<"+t+r+this.tagEndChar+e+this.indentate(n)+"</"+t+this.tagEndChar}function buildEmptyObjNode(e,t,r,n){return""!==e?this.buildObjectNode(e,t,r,n):this.indentate(n)+"<"+t+r+"/"+this.tagEndChar}function buildTextValNode(e,t,r,n){return this.indentate(n)+"<"+t+r+">"+this.options.tagValueProcessor(e)+"</"+t+this.tagEndChar}function buildEmptyTextNode(e,t,r,n){return""!==e?this.buildTextValNode(e,t,r,n):this.indentate(n)+"<"+t+r+"/"+this.tagEndChar}function indentate(e){return this.options.indentBy.repeat(e)}function isAttribute(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}function isCDATA(e){return e===this.options.cdataTagName}Parser.prototype.parse=function(e){return this.j2x(e,0).val},Parser.prototype.j2x=function(e,t){let r="",n="";const o=Object.keys(e),s=o.length;for(let i=0;i<s;i++){const s=o[i];if(void 0===e[s]);else if(null===e[s])n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)n+=this.buildTextNode(e[s],s,"",t);else if("object"!=typeof e[s]){const o=this.isAttribute(s);o?r+=" "+o+'="'+this.options.attrValueProcessor(""+e[s])+'"':this.isCDATA(s)?e[this.options.textNodeName]?n+=this.replaceCDATAstr(e[this.options.textNodeName],e[s]):n+=this.replaceCDATAstr("",e[s]):s===this.options.textNodeName?e[this.options.cdataTagName]||(n+=this.options.tagValueProcessor(""+e[s])):n+=this.buildTextNode(e[s],s,"",t)}else if(Array.isArray(e[s]))if(this.isCDATA(s))n+=this.indentate(t),e[this.options.textNodeName]?n+=this.replaceCDATAarr(e[this.options.textNodeName],e[s]):n+=this.replaceCDATAarr("",e[s]);else{const r=e[s].length;for(let o=0;o<r;o++){const r=e[s][o];if(void 0===r);else if(null===r)n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if("object"==typeof r){const e=this.j2x(r,t+1);n+=this.buildObjNode(e.val,s,e.attrStr,t)}else n+=this.buildTextNode(r,s,"",t)}}else if(this.options.attrNodeName&&s===this.options.attrNodeName){const t=Object.keys(e[s]),n=t.length;for(let o=0;o<n;o++)r+=" "+t[o]+'="'+this.options.attrValueProcessor(""+e[s][t[o]])+'"'}else{const r=this.j2x(e[s],t+1);n+=this.buildObjNode(r.val,s,r.attrStr,t)}}return{attrStr:r,val:n}};var json2xml=Parser,parser=createCommonjsModule(function(e,t){const r=xmlstr2xmlnode,n=util.buildOptions;t.parse=function(e,t){return t=n(t,r.defaultOptions,r.props),node2json.convertToJson(xmlstr2xmlnode.getTraversalObj(e,t),t)},t.convertTonimn=nimndata.convert2nimn,t.getTraversalObj=xmlstr2xmlnode.getTraversalObj,t.convertToJson=node2json.convertToJson,t.convertToJsonString=node2json_str.convertToJsonString,t.validate=validator.validate,t.j2xParser=json2xml,t.parseToNimn=function(e,r,n){return t.convertTonimn(t.getTraversalObj(e,n),r,n)}}),parser_1=parser.parse,parser_2=parser.convertTonimn,parser_3=parser.getTraversalObj,parser_4=parser.convertToJson,parser_5=parser.convertToJsonString,parser_6=parser.validate,parser_7=parser.j2xParser,parser_8=parser.parseToNimn,punycode=createCommonjsModule(function(e,t){!function(r){var n=t&&!t.nodeType&&t,o=e&&!e.nodeType&&e,s="object"==typeof commonjsGlobal&&commonjsGlobal;s.global!==s&&s.window!==s&&s.self!==s||(r=s);var i,a,u=2147483647,c=36,l=1,h=26,f=38,p=700,d=72,m=128,g="-",y=/^xn--/,_=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=c-l,A=Math.floor,S=String.fromCharCode;function T(e){throw RangeError(E[e])}function C(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function N(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+C((e=e.replace(b,".")).split("."),t).join(".")}function w(e){for(var t,r,n=[],o=0,s=e.length;o<s;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<s?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function P(e){return C(e,function(e){var t="";return e>65535&&(t+=S((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=S(e)}).join("")}function O(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,r){var n=0;for(e=r?A(e/p):e>>1,e+=A(e/t);e>v*h>>1;n+=c)e=A(e/v);return A(n+(v+1)*e/(e+f))}function R(e){var t,r,n,o,s,i,a,f,p,y,_,b=[],E=e.length,v=0,S=m,C=d;for((r=e.lastIndexOf(g))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&T("not-basic"),b.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<E;){for(s=v,i=1,a=c;o>=E&&T("invalid-input"),((f=(_=e.charCodeAt(o++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||f>A((u-v)/i))&&T("overflow"),v+=f*i,!(f<(p=a<=C?l:a>=C+h?h:a-C));a+=c)i>A(u/(y=c-p))&&T("overflow"),i*=y;C=x(v-s,t=b.length+1,0==s),A(v/t)>u-S&&T("overflow"),S+=A(v/t),v%=t,b.splice(v++,0,S)}return P(b)}function I(e){var t,r,n,o,s,i,a,f,p,y,_,b,E,v,C,N=[];for(b=(e=w(e)).length,t=m,r=0,s=d,i=0;i<b;++i)(_=e[i])<128&&N.push(S(_));for(n=o=N.length,o&&N.push(g);n<b;){for(a=u,i=0;i<b;++i)(_=e[i])>=t&&_<a&&(a=_);for(a-t>A((u-r)/(E=n+1))&&T("overflow"),r+=(a-t)*E,t=a,i=0;i<b;++i)if((_=e[i])<t&&++r>u&&T("overflow"),_==t){for(f=r,p=c;!(f<(y=p<=s?l:p>=s+h?h:p-s));p+=c)C=f-y,v=c-y,N.push(S(O(y+C%v,0))),f=A(C/v);N.push(S(O(f,0))),s=x(r,E,n==o),r=0,++n}++r,++t}return N.join("")}if(i={version:"1.3.2",ucs2:{decode:w,encode:P},decode:R,encode:I,toASCII:function(e){return N(e,function(e){return _.test(e)?"xn--"+I(e):e})},toUnicode:function(e){return N(e,function(e){return y.test(e)?R(e.slice(4).toLowerCase()):e})}},n&&o)if(e.exports==n)o.exports=i;else for(a in i)i.hasOwnProperty(a)&&(n[a]=i[a]);else r.punycode=i}(commonjsGlobal)}),util$1={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}};function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var decode=function(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var a=e.length;i>0&&a>i&&(a=i);for(var u=0;u<a;++u){var c,l,h,f,p=e[u].replace(s,"%20"),d=p.indexOf(r);d>=0?(c=p.substr(0,d),l=p.substr(d+1)):(c=p,l=""),h=decodeURIComponent(c),f=decodeURIComponent(l),hasOwnProperty(o,h)?Array.isArray(o[h])?o[h].push(f):o[h]=[o[h],f]:o[h]=f}return o},stringifyPrimitive=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},encode=function(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(n){var o=encodeURIComponent(stringifyPrimitive(n))+r;return Array.isArray(e[n])?e[n].map(function(e){return o+encodeURIComponent(stringifyPrimitive(e))}).join(t):o+encodeURIComponent(stringifyPrimitive(e[n]))}).join(t):n?encodeURIComponent(stringifyPrimitive(n))+r+encodeURIComponent(stringifyPrimitive(e)):""},querystring=createCommonjsModule(function(e,t){t.decode=t.parse=decode,t.encode=t.stringify=encode}),querystring_1=querystring.decode,querystring_2=querystring.parse,querystring_3=querystring.encode,querystring_4=querystring.stringify,parse=urlParse,resolve=urlResolve,resolveObject=urlResolveObject,format=urlFormat,Url_1=Url;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(e,t,r){if(e&&util$1.isObject(e)&&e instanceof Url)return e;var n=new Url;return n.parse(e,t,r),n}function urlFormat(e){return util$1.isString(e)&&(e=urlParse(e)),e instanceof Url?e.format():Url.prototype.format.call(e)}function urlResolve(e,t){return urlParse(e,!1,!0).resolve(t)}function urlResolveObject(e,t){return e?urlParse(e,!1,!0).resolveObject(t):t}Url.prototype.parse=function(e,t,r){if(!util$1.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",s=e.split(o);s[0]=s[0].replace(/\\/g,"/");var i=e=s.join(o);if(i=i.trim(),!r&&1===e.split("#").length){var a=simplePathPattern.exec(i);if(a)return this.path=i,this.href=i,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?querystring.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var u=protocolPattern.exec(i);if(u){var c=(u=u[0]).toLowerCase();this.protocol=c,i=i.substr(u.length)}if(r||u||i.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===i.substr(0,2);!l||u&&hostlessProtocol[u]||(i=i.substr(2),this.slashes=!0)}if(!hostlessProtocol[u]&&(l||u&&!slashedProtocol[u])){for(var h,f,p=-1,d=0;d<hostEndingChars.length;d++){-1!==(m=i.indexOf(hostEndingChars[d]))&&(-1===p||m<p)&&(p=m)}-1!==(f=-1===p?i.lastIndexOf("@"):i.lastIndexOf("@",p))&&(h=i.slice(0,f),i=i.slice(f+1),this.auth=decodeURIComponent(h)),p=-1;for(d=0;d<nonHostChars.length;d++){var m;-1!==(m=i.indexOf(nonHostChars[d]))&&(-1===p||m<p)&&(p=m)}-1===p&&(p=i.length),this.host=i.slice(0,p),i=i.slice(p),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var y=this.hostname.split(/\./),_=(d=0,y.length);d<_;d++){var b=y[d];if(b&&!b.match(hostnamePartPattern)){for(var E="",v=0,A=b.length;v<A;v++)b.charCodeAt(v)>127?E+="x":E+=b[v];if(!E.match(hostnamePartPattern)){var S=y.slice(0,d),T=y.slice(d+1),C=b.match(hostnamePartStart);C&&(S.push(C[1]),T.unshift(C[2])),T.length&&(i="/"+T.join(".")+i),this.hostname=S.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=punycode.toASCII(this.hostname));var N=this.port?":"+this.port:"",w=this.hostname||"";this.host=w+N,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!unsafeProtocol[c])for(d=0,_=autoEscape.length;d<_;d++){var P=autoEscape[d];if(-1!==i.indexOf(P)){var O=encodeURIComponent(P);O===P&&(O=escape(P)),i=i.split(P).join(O)}}var x=i.indexOf("#");-1!==x&&(this.hash=i.substr(x),i=i.slice(0,x));var R=i.indexOf("?");if(-1!==R?(this.search=i.substr(R),this.query=i.substr(R+1),t&&(this.query=querystring.parse(this.query)),i=i.slice(0,R)):t&&(this.search="",this.query={}),i&&(this.pathname=i),slashedProtocol[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var I=this.search||"";this.path=N+I}return this.href=this.format(),this},Url.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&util$1.isObject(this.query)&&Object.keys(this.query).length&&(s=querystring.stringify(this.query));var i=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||slashedProtocol[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),i&&"?"!==i.charAt(0)&&(i="?"+i),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+n},Url.prototype.resolve=function(e){return this.resolveObject(urlParse(e,!1,!0)).format()},Url.prototype.resolveObject=function(e){if(util$1.isString(e)){var t=new Url;t.parse(e,!1,!0),e=t}for(var r=new Url,n=Object.keys(this),o=0;o<n.length;o++){var s=n[o];r[s]=this[s]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),a=0;a<i.length;a++){var u=i[a];"protocol"!==u&&(r[u]=e[u])}return slashedProtocol[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!slashedProtocol[e.protocol]){for(var c=Object.keys(e),l=0;l<c.length;l++){var h=c[l];r[h]=e[h]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||hostlessProtocol[e.protocol])r.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var p=r.pathname||"",d=r.search||"";r.path=p+d}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=g||m||r.host&&e.pathname,_=y,b=r.pathname&&r.pathname.split("/")||[],E=(f=e.pathname&&e.pathname.split("/")||[],r.protocol&&!slashedProtocol[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),y=y&&(""===f[0]||""===b[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,b=f;else if(f.length)b||(b=[]),b.pop(),b=b.concat(f),r.search=e.search,r.query=e.query;else if(!util$1.isNullOrUndefined(e.search)){if(E)r.hostname=r.host=b.shift(),(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift());return r.search=e.search,r.query=e.query,util$1.isNull(r.pathname)&&util$1.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var v=b.slice(-1)[0],A=(r.host||e.host||b.length>1)&&("."===v||".."===v)||""===v,S=0,T=b.length;T>=0;T--)"."===(v=b[T])?b.splice(T,1):".."===v?(b.splice(T,1),S++):S&&(b.splice(T,1),S--);if(!y&&!_)for(;S--;S)b.unshift("..");!y||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),A&&"/"!==b.join("/").substr(-1)&&b.push("");var C,N=""===b[0]||b[0]&&"/"===b[0].charAt(0);E&&(r.hostname=r.host=N?"":b.length?b.shift():"",(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift()));return(y=y||r.host&&b.length)&&!N&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),util$1.isNull(r.pathname)&&util$1.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},Url.prototype.parseHost=function(){var e=this.host,t=portPattern.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var url={parse:parse,resolve:resolve,resolveObject:resolveObject,format:format,Url:Url_1};const Readable=Stream.Readable,BUFFER=Symbol("buffer"),TYPE=Symbol("type");class Blob{constructor(){this[TYPE]="";const e=arguments[0],t=arguments[1],r=[];let n=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let s;n+=(s=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof Blob?o[BUFFER]:Buffer.from("string"==typeof o?o:String(o))).length,r.push(s)}}this[BUFFER]=Buffer.concat(r);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[TYPE]=o)}get size(){return this[BUFFER].length}get type(){return this[TYPE]}text(){return Promise.resolve(this[BUFFER].toString())}arrayBuffer(){const e=this[BUFFER],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new Readable;return e._read=function(){},e.push(this[BUFFER]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let n,o;n=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const s=Math.max(o-n,0),i=this[BUFFER].slice(n,n+s),a=new Blob([],{type:arguments[2]});return a[BUFFER]=i,a}}function FetchError(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let convert;Object.defineProperties(Blob.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(Blob.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),FetchError.prototype=Object.create(Error.prototype),FetchError.prototype.constructor=FetchError,FetchError.prototype.name="FetchError";try{convert=require("encoding").convert}catch(e){}const INTERNALS=Symbol("Body internals"),PassThrough=Stream.PassThrough;function Body(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.size;let o=void 0===n?0:n;var s=r.timeout;let i=void 0===s?0:s;null==e?e=null:isURLSearchParams(e)?e=Buffer.from(e.toString()):isBlob(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Stream||(e=Buffer.from(String(e)))),this[INTERNALS]={body:e,disturbed:!1,error:null},this.size=o,this.timeout=i,e instanceof Stream&&e.on("error",function(e){const r="AbortError"===e.name?e:new FetchError(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[INTERNALS].error=r})}function consumeBody(){var e=this;if(this[INTERNALS].disturbed)return Body.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[INTERNALS].disturbed=!0,this[INTERNALS].error)return Body.Promise.reject(this[INTERNALS].error);let t=this.body;if(null===t)return Body.Promise.resolve(Buffer.alloc(0));if(isBlob(t)&&(t=t.stream()),Buffer.isBuffer(t))return Body.Promise.resolve(t);if(!(t instanceof Stream))return Body.Promise.resolve(Buffer.alloc(0));let r=[],n=0,o=!1;return new Body.Promise(function(s,i){let a;e.timeout&&(a=setTimeout(function(){o=!0,i(new FetchError(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),t.on("error",function(t){"AbortError"===t.name?(o=!0,i(t)):i(new FetchError(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))}),t.on("data",function(t){if(!o&&null!==t){if(e.size&&n+t.length>e.size)return o=!0,void i(new FetchError(`content size at ${e.url} over limit: ${e.size}`,"max-size"));n+=t.length,r.push(t)}}),t.on("end",function(){if(!o){clearTimeout(a);try{s(Buffer.concat(r,n))}catch(t){i(new FetchError(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}})})}function convertBody(e,t){if("function"!=typeof convert)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let n,o,s="utf-8";return r&&(n=/charset=([^;]*)/i.exec(r)),o=e.slice(0,1024).toString(),!n&&o&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(o)),!n&&o&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o))&&(n=/charset=(.*)/i.exec(n.pop())),!n&&o&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o)),n&&("gb2312"!==(s=n.pop())&&"gbk"!==s||(s="gb18030")),convert(e,"UTF-8",s).toString()}function isURLSearchParams(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function isBlob(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function clone(e){let t,r,n=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return n instanceof Stream&&"function"!=typeof n.getBoundary&&(t=new PassThrough,r=new PassThrough,n.pipe(t),n.pipe(r),e[INTERNALS].body=t,n=r),n}function extractContentType(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":isURLSearchParams(e)?"application/x-www-form-urlencoded;charset=UTF-8":isBlob(e)?e.type||null:Buffer.isBuffer(e)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(e)?null:ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?`multipart/form-data;boundary=${e.getBoundary()}`:e instanceof Stream?null:"text/plain;charset=UTF-8"}function getTotalBytes(e){const t=e.body;return null===t?0:isBlob(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}function writeToStream(e,t){const r=t.body;null===r?e.end():isBlob(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}Body.prototype={get body(){return this[INTERNALS].body},get bodyUsed(){return this[INTERNALS].disturbed},arrayBuffer(){return consumeBody.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return consumeBody.call(this).then(function(t){return Object.assign(new Blob([],{type:e.toLowerCase()}),{[BUFFER]:t})})},json(){var e=this;return consumeBody.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(t){return Body.Promise.reject(new FetchError(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}})},text(){return consumeBody.call(this).then(function(e){return e.toString()})},buffer(){return consumeBody.call(this)},textConverted(){var e=this;return consumeBody.call(this).then(function(t){return convertBody(t,e.headers)})}},Object.defineProperties(Body.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),Body.mixIn=function(e){for(const t of Object.getOwnPropertyNames(Body.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(Body.prototype,t);Object.defineProperty(e,t,r)}},Body.Promise=global.Promise;const invalidTokenRegex=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,invalidHeaderCharRegex=/[^\t\x20-\x7e\x80-\xff]/;function validateName(e){if(e=`${e}`,invalidTokenRegex.test(e)||""===e)throw new TypeError(`${e} is not a legal HTTP header name`)}function validateValue(e){if(e=`${e}`,invalidHeaderCharRegex.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function find(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const MAP=Symbol("map");class Headers{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[MAP]=Object.create(null),e instanceof Headers){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){validateName(e=`${e}`);const t=find(this[MAP],e);return void 0===t?null:this[MAP][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=getHeaders(this),n=0;for(;n<r.length;){var o=r[n];const s=o[0],i=o[1];e.call(t,i,s,this),r=getHeaders(this),n++}}set(e,t){t=`${t}`,validateName(e=`${e}`),validateValue(t);const r=find(this[MAP],e);this[MAP][void 0!==r?r:e]=[t]}append(e,t){t=`${t}`,validateName(e=`${e}`),validateValue(t);const r=find(this[MAP],e);void 0!==r?this[MAP][r].push(t):this[MAP][e]=[t]}has(e){return validateName(e=`${e}`),void 0!==find(this[MAP],e)}delete(e){validateName(e=`${e}`);const t=find(this[MAP],e);void 0!==t&&delete this[MAP][t]}raw(){return this[MAP]}keys(){return createHeadersIterator(this,"key")}values(){return createHeadersIterator(this,"value")}[Symbol.iterator](){return createHeadersIterator(this,"key+value")}}function getHeaders(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[MAP]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[MAP][t].join(", ")}:function(t){return[t.toLowerCase(),e[MAP][t].join(", ")]})}Headers.prototype.entries=Headers.prototype[Symbol.iterator],Object.defineProperty(Headers.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Headers.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const INTERNAL=Symbol("internal");function createHeadersIterator(e,t){const r=Object.create(HeadersIteratorPrototype);return r[INTERNAL]={target:e,kind:t,index:0},r}const HeadersIteratorPrototype=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==HeadersIteratorPrototype)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[INTERNAL];const t=e.target,r=e.kind,n=e.index,o=getHeaders(t,r);return n>=o.length?{value:void 0,done:!0}:(this[INTERNAL].index=n+1,{value:o[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function exportNodeCompatibleHeaders(e){const t=Object.assign({__proto__:null},e[MAP]),r=find(e[MAP],"Host");return void 0!==r&&(t[r]=t[r][0]),t}function createHeadersLenient(e){const t=new Headers;for(const r of Object.keys(e))if(!invalidTokenRegex.test(r))if(Array.isArray(e[r]))for(const n of e[r])invalidHeaderCharRegex.test(n)||(void 0===t[MAP][r]?t[MAP][r]=[n]:t[MAP][r].push(n));else invalidHeaderCharRegex.test(e[r])||(t[MAP][r]=[e[r]]);return t}Object.defineProperty(HeadersIteratorPrototype,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const INTERNALS$1=Symbol("Response internals"),STATUS_CODES=http.STATUS_CODES;class Response{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Body.call(this,e,t);const r=t.status||200,n=new Headers(t.headers);if(null!=e&&!n.has("Content-Type")){const t=extractContentType(e);t&&n.append("Content-Type",t)}this[INTERNALS$1]={url:t.url,status:r,statusText:t.statusText||STATUS_CODES[r],headers:n,counter:t.counter}}get url(){return this[INTERNALS$1].url||""}get status(){return this[INTERNALS$1].status}get ok(){return this[INTERNALS$1].status>=200&&this[INTERNALS$1].status<300}get redirected(){return this[INTERNALS$1].counter>0}get statusText(){return this[INTERNALS$1].statusText}get headers(){return this[INTERNALS$1].headers}clone(){return new Response(clone(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}Body.mixIn(Response.prototype),Object.defineProperties(Response.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(Response.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const INTERNALS$2=Symbol("Request internals"),parse_url=url.parse,format_url=url.format,streamDestructionSupported="destroy"in Stream.Readable.prototype;function isRequest(e){return"object"==typeof e&&"object"==typeof e[INTERNALS$2]}function isAbortSignal(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}class Request{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isRequest(e)?t=parse_url(e.url):(t=e&&e.href?parse_url(e.href):parse_url(`${e}`),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||isRequest(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=r.body?r.body:isRequest(e)&&null!==e.body?clone(e):null;Body.call(this,o,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const s=new Headers(r.headers||e.headers||{});if(null!=o&&!s.has("Content-Type")){const e=extractContentType(o);e&&s.append("Content-Type",e)}let i=isRequest(e)?e.signal:null;if("signal"in r&&(i=r.signal),null!=i&&!isAbortSignal(i))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[INTERNALS$2]={method:n,redirect:r.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:i},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[INTERNALS$2].method}get url(){return format_url(this[INTERNALS$2].parsedURL)}get headers(){return this[INTERNALS$2].headers}get redirect(){return this[INTERNALS$2].redirect}get signal(){return this[INTERNALS$2].signal}clone(){return new Request(this)}}function getNodeRequestOptions(e){const t=e[INTERNALS$2].parsedURL,r=new Headers(e[INTERNALS$2].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof Stream.Readable&&!streamDestructionSupported)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let n=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(n="0"),null!=e.body){const t=getTotalBytes(e);"number"==typeof t&&(n=String(t))}n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let o=e.agent;return"function"==typeof o&&(o=o(t)),r.has("Connection")||o||r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:exportNodeCompatibleHeaders(r),agent:o})}function AbortError(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}Body.mixIn(Request.prototype),Object.defineProperty(Request.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Request.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),AbortError.prototype=Object.create(Error.prototype),AbortError.prototype.constructor=AbortError,AbortError.prototype.name="AbortError";const PassThrough$1=Stream.PassThrough,resolve_url=url.resolve;function fetch(e,t){if(!fetch.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return Body.Promise=fetch.Promise,new fetch.Promise(function(r,n){const o=new Request(e,t),s=getNodeRequestOptions(o),i=("https:"===s.protocol?https:http).request,a=o.signal;let u=null;const c=function(){let e=new AbortError("The user aborted a request.");n(e),o.body&&o.body instanceof Stream.Readable&&o.body.destroy(e),u&&u.body&&u.body.emit("error",e)};if(a&&a.aborted)return void c();const l=function(){c(),p()},h=i(s);let f;function p(){h.abort(),a&&a.removeEventListener("abort",l),clearTimeout(f)}a&&a.addEventListener("abort",l),o.timeout&&h.once("socket",function(e){f=setTimeout(function(){n(new FetchError(`network timeout at: ${o.url}`,"request-timeout")),p()},o.timeout)}),h.on("error",function(e){n(new FetchError(`request to ${o.url} failed, reason: ${e.message}`,"system",e)),p()}),h.on("response",function(e){clearTimeout(f);const t=createHeadersLenient(e.headers);if(fetch.isRedirect(e.statusCode)){const s=t.get("Location"),i=null===s?null:resolve_url(o.url,s);switch(o.redirect){case"error":return n(new FetchError(`redirect mode is set to error: ${o.url}`,"no-redirect")),void p();case"manual":if(null!==i)try{t.set("Location",i)}catch(e){n(e)}break;case"follow":if(null===i)break;if(o.counter>=o.follow)return n(new FetchError(`maximum redirect reached at: ${o.url}`,"max-redirect")),void p();const s={headers:new Headers(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:o.body,signal:o.signal,timeout:o.timeout};return 303!==e.statusCode&&o.body&&null===getTotalBytes(o)?(n(new FetchError("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void p()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==o.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length")),r(fetch(new Request(i,s))),void p())}}e.once("end",function(){a&&a.removeEventListener("abort",l)});let s=e.pipe(new PassThrough$1);const i={url:o.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:o.size,timeout:o.timeout,counter:o.counter},c=t.get("Content-Encoding");if(!o.compress||"HEAD"===o.method||null===c||204===e.statusCode||304===e.statusCode)return u=new Response(s,i),void r(u);const h={flush:zlib.Z_SYNC_FLUSH,finishFlush:zlib.Z_SYNC_FLUSH};if("gzip"==c||"x-gzip"==c)return s=s.pipe(zlib.createGunzip(h)),u=new Response(s,i),void r(u);if("deflate"!=c&&"x-deflate"!=c){if("br"==c&&"function"==typeof zlib.createBrotliDecompress)return s=s.pipe(zlib.createBrotliDecompress()),u=new Response(s,i),void r(u);u=new Response(s,i),r(u)}else{e.pipe(new PassThrough$1).once("data",function(e){s=8==(15&e[0])?s.pipe(zlib.createInflate()):s.pipe(zlib.createInflateRaw()),u=new Response(s,i),r(u)})}}),writeToStream(h,o)})}fetch.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},fetch.Promise=global.Promise;var US_GET_GAMES_OPTIONS={system:"platform:Nintendo Switch",sort:"title",direction:"asc"},US_ALGOLIA_ID="U3B6GR4UA3",US_ALGOLIA_KEY="9a20c93440cf63cf1a7008d75f7438bf",US_GET_GAMES_URL="https://"+US_ALGOLIA_ID+"-dsn.algolia.net/1/indexes/*/queries",US_GAME_CHECK_CODE="70010000000185",US_GAME_CODE_REGEX=/HAC\w(\w{4})/,US_GAME_LIST_LIMIT=200,US_PRICE_RANGES=["Free to start","$0 - $4.99","$5 - $9.99","$10 - $19.99","$20 - $39.99","$40+"],EU_GET_GAMES_OPTIONS={fq:"type:GAME AND system_type:nintendoswitch* AND product_code_txt:*",q:"*",sort:"sorting_title asc",start:"0",wt:"json"},EU_GET_GAMES_URL="http://search.nintendo-europe.com/{locale}/select",EU_GAME_CHECK_CODE="70010000000184",EU_GAME_CODE_REGEX=/HAC\w(\w{4})/,EU_DEFAULT_LOCALE="en",EU_GAME_LIST_LIMIT=9999,JP_GET_GAMES_CURRENT="https://www.nintendo.co.jp/data/software/xml-system/switch-onsale.xml",JP_GET_GAMES_COMING="https://www.nintendo.co.jp/data/software/xml-system/switch-coming.xml",JP_GAME_CHECK_CODE="70010000000039",JP_GAME_CODE_REGEX=/\/HAC(\w{4})/,JP_NSUID_REGEX=/\d{14}/,PRICE_GET_URL="https://api.ec.nintendo.com/v1/price",PRICE_GET_OPTIONS={lang:"en"},PRICE_LIST_LIMIT=50,EshopError=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t,r.name="EshopError",r.stack="",r}return __extends(t,e),t}(Error);!function(e){e[e.AMERICAS=1]="AMERICAS",e[e.EUROPE=2]="EUROPE",e[e.ASIA=3]="ASIA"}(exports.Region||(exports.Region={}));var _this=void 0,arrayRemoveDuplicates=function(e,t){var r=[];return e.filter(function(e){var n=t?e[t]:e;return!r.includes(n)&&r.push(n)})},hasProp=function(e,t){return e&&t in e},isStringArray=function(e){return Array.isArray(e)},getGamesAmerica=function(e,t,r){return void 0===e&&(e={}),void 0===t&&(t=0),void 0===r&&(r=[]),__awaiter(_this,void 0,void 0,function(){var o,s,i,a,u,c,l,h,f,p,d,m,g,y,_,b,E,v,A=this;return __generator(this,function(S){switch(S.label){case 0:o=hasProp(e,"limit")?e.limit:US_GAME_LIST_LIMIT,s=hasProp(e,"shop")?e.shop:"ncom",i="unfiltered"===(i="all"===s?["ncom","retail"]:s)?void 0:i,a=Math.floor(t/o),u=function(e){switch(e){case"ncom":return"filterShops:On Nintendo.com";case"retail":return"filterShops:On retail";default:return""}},c=[""],i&&(c=isStringArray(i)?i.map(function(e){return u(e)}):u(i)),l={direction:US_GET_GAMES_OPTIONS.direction,sortBy:US_GET_GAMES_OPTIONS.sort},h={body:JSON.stringify({requests:[{indexName:"noa_aem_game_en_us"+(l.sortBy&&l.direction?"_"+l.sortBy+"_"+l.direction:""),params:n({facetFilters:[[US_GET_GAMES_OPTIONS.system],c],hitsPerPage:o,page:a})}]}),headers:{"Content-Type":"application/json"},method:"post"},S.label=1;case 1:return S.trys.push([1,10,,11]),hasProp(e,"limit")?[4,fetch(US_GET_GAMES_URL+"?"+n({"x-algolia-api-key":US_ALGOLIA_KEY,"x-algolia-application-id":US_ALGOLIA_ID}),h)]:[3,6];case 2:if(!(f=S.sent()).ok)throw new Error("US_games_request_failed");return[4,f.json()];case 3:return p=S.sent(),d=arrayRemoveDuplicates(r.concat(p.results[0].hits),"slug"),!hasProp(e,"limit")&&p.results[0].hits.length+t<p.results[0].nbHits?[4,getGamesAmerica(e,t+o,d)]:[3,5];case 4:return[2,S.sent()];case 5:return[2,d];case 6:return m={body:JSON.stringify({requests:[{indexName:"noa_aem_game_en_us",params:n({facetFilters:[[US_GET_GAMES_OPTIONS.system],c],facets:["categories"],hitsPerPage:0})}]}),headers:{"Content-Type":"application/json"},method:"post"},[4,fetch(US_GET_GAMES_URL+"?"+n({"x-algolia-api-key":US_ALGOLIA_KEY,"x-algolia-application-id":US_ALGOLIA_ID}),m)];case 7:if(!(g=S.sent()).ok)throw new Error("US_games_request_failed");return[4,g.json()];case 8:return y=S.sent(),_=y.results[0].facets.categories,b=Object.entries(_).map(function(e){var t=e[0],r=e[1];return __awaiter(A,void 0,void 0,function(){var e,o,s,i,a;return __generator(this,function(u){switch(u.label){case 0:return e=[{indexName:"noa_aem_game_en_us",params:n({facetFilters:JSON.stringify([[US_GET_GAMES_OPTIONS.system],["categories:"+t],c]),hitsPerPage:1e3})}],o=US_PRICE_RANGES.map(function(e){return{indexName:"noa_aem_game_en_us",params:n({facetFilters:JSON.stringify([[US_GET_GAMES_OPTIONS.system],["categories:"+t],["priceRange:"+e],c]),facets:["platform","categories"],hitsPerPage:1e3})}}),s={body:JSON.stringify({requests:r>1e3?o:e}),headers:{"Content-Type":"application/json"},method:"post"},[4,fetch(US_GET_GAMES_URL+"?"+n({"x-algolia-api-key":US_ALGOLIA_KEY,"x-algolia-application-id":US_ALGOLIA_ID}),s)];case 1:if(!(i=u.sent()).ok)throw new Error("US_games_request_failed");return[4,i.json()];case 2:return a=u.sent(),[2,r>1e3?a.results.map(function(e){return e.hits}).reduce(function(e,t){return e.concat(t,[])}):a.results[0].hits]}})})}),[4,Promise.all(b)];case 9:return E=S.sent().reduce(function(e,t){return e.concat(t,[])}),[2,E=arrayRemoveDuplicates(E,"slug")];case 10:if(v=S.sent(),/(?:US_games_request_failed)/i.test(v.toString()))throw new EshopError("Fetching of US Games failed");throw v;case 11:return[2]}})})},getGamesJapan=function(){return __awaiter(_this,void 0,void 0,function(){var e,t,r,n,o,s,i,a,u;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),[4,fetch(JP_GET_GAMES_CURRENT)];case 1:return e=c.sent(),[4,fetch(JP_GET_GAMES_COMING)];case 2:if(t=c.sent(),!e.ok)throw new Error("JP_current_games_US_games_request_failed");if(!t.ok)throw new Error("JP_coming_games_US_games_request_failed");return n=parser_1,[4,e.text()];case 3:return r=n.apply(void 0,[c.sent()]),s=parser_1,[4,t.text()];case 4:return o=s.apply(void 0,[c.sent()]),i=r.TitleInfoList.TitleInfo,a=o.TitleInfoList.TitleInfo,[2,i.concat(a)];case 5:if(u=c.sent(),/(?:JP_current_games_US_games_request_failed)/i.test(u.toString()))throw new EshopError("Fetching of Current JP Games failed");if(/(?:JP_coming_games_US_games_request_failed)/i.test(u.toString()))throw new EshopError("Fetching of Upcoming JP Games failed");throw u;case 6:return[2]}})})},getGamesEurope=function(e){return void 0===e&&(e={limit:EU_GAME_LIST_LIMIT,locale:EU_DEFAULT_LOCALE}),__awaiter(_this,void 0,void 0,function(){var t,r;return __generator(this,function(o){switch(o.label){case 0:e.limit||(e.limit=EU_GAME_LIST_LIMIT),e.locale||(e.locale=EU_DEFAULT_LOCALE),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(EU_GET_GAMES_URL.replace("{locale}",e.locale)+"?"+n(__assign({rows:e.limit},EU_GET_GAMES_OPTIONS)))];case 2:if(!(t=o.sent()).ok)throw new Error("EU_games_request_failed");return[4,t.json()];case 3:return[2,o.sent().response.docs];case 4:if(r=o.sent(),/(?:EU_games_request_failed)/i.test(r.toString()))throw new EshopError("Fetching of EU Games failed");throw r;case 5:return[2]}})})},getPrices=function(e,t,r,o){return void 0===r&&(r=0),void 0===o&&(o=[]),__awaiter(_this,void 0,void 0,function(){var s,i,a,u,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,6,,7]),s=t.slice(r,r+PRICE_LIST_LIMIT),[4,fetch(PRICE_GET_URL+"?"+n(__assign({country:e,ids:s,limit:PRICE_LIST_LIMIT},PRICE_GET_OPTIONS)))];case 1:if(403===(i=l.sent()).status)throw new Error("PRICE_Rate_Limit");if(!i.ok)throw new Error("PRICE_get_request_failed");return[4,i.json()];case 2:return(a=l.sent()).prices&&a.prices.length+r<t.length?(u=o.concat(a.prices),[4,getPrices(e,t,r+PRICE_LIST_LIMIT,u)]):[3,4];case 3:return[2,l.sent()];case 4:if(a.prices)return a.prices=a.prices.concat(o),[2,a];l.label=5;case 5:return[2,a];case 6:if(c=l.sent(),/(?:PRICE_Rate_Limit)/i.test(c.toString()))throw new EshopError("Looks like you ran into a rate limit while getting price data, please do not spam the Nintendo servers.");if(/(?:PRICE_get_request_failed)/i.test(c.toString()))throw new EshopError("Fetching of eShop prices failed");throw c;case 7:return[2]}})})},getShopsByCountryCodes=function(e,t,r){return __awaiter(_this,void 0,void 0,function(){var n,o,s,i,a,u,c,l,h;return __generator(this,function(f){switch(f.label){case 0:f.trys.push([0,7,,8]),n=e.map(function(e){return countryData_3.all.filter(function(t){return t.alpha2===e})[0]}),o=[],s=0,i=n,f.label=1;case 1:if(!(s<i.length))return[3,6];a=i[s],f.label=2;case 2:return f.trys.push([2,4,,5]),[4,getPrices(a.alpha2,t)];case 3:return(u=f.sent()).country=a,o.push(u),[3,5];case 4:return f.sent(),[3,5];case 5:return s++,[3,1];case 6:if(c=o.filter(function(e){return e&&e.prices&&e.prices.length&&e.prices[0].regular_price}),!(l=c.map(function(e){return{code:e.country.alpha2,country:e.country.name,currency:e.prices[0].regular_price.currency,region:r}})).length)throw new Error("ACTIVE_SHOPS_Rate_Limit");return[2,l];case 7:if(h=f.sent(),/(?:ACTIVE_SHOPS_Rate_Limit)/i.test(h.toString()))throw new EshopError("Looks like you ran into a rate limit while getting price data, please do not spam the Nintendo servers.");throw h;case 8:return[2]}})})},getShopsAmerica=function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(e){return[2,getShopsByCountryCodes(countryData_2.southAmerica.countries.concat(countryData_2.centralAfrica.countries,countryData_2.northernAmerica.countries),US_GAME_CHECK_CODE,exports.Region.AMERICAS)]})})},getShopsEurope=function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(e){return[2,getShopsByCountryCodes(countryData_2.northernEurope.countries.concat(countryData_2.southernEurope.countries,countryData_2.easternEurope.countries,countryData_2.westernEurope.countries,countryData_2.australia.countries,countryData_2.southernAfrica.countries),EU_GAME_CHECK_CODE,exports.Region.EUROPE)]})})},getShopsAsia=function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(e){return[2,getShopsByCountryCodes(countryData_2.southernAsia.countries.concat(countryData_2.southernAsia.countries,countryData_2.southeastAsia.countries,countryData_2.eastAsia.countries,countryData_2.westernAsia.countries),JP_GAME_CHECK_CODE,exports.Region.ASIA)]})})},getActiveShops=function(){return __awaiter(_this,void 0,void 0,function(){var e,t,r;return __generator(this,function(n){switch(n.label){case 0:return[4,getShopsAmerica()];case 1:return e=n.sent(),[4,getShopsAsia()];case 2:return t=n.sent(),[4,getShopsEurope()];case 3:return r=n.sent(),[2,e.concat(t,r)]}})})},parseGameCode=function(e,t){var r;switch(t){case exports.Region.EUROPE:r=EU_GAME_CODE_REGEX.exec(e.product_code_txt[0]);break;case exports.Region.ASIA:r=JP_GAME_CODE_REGEX.exec(e.ScreenshotImgURL[0]);break;default:case exports.Region.AMERICAS:r=US_GAME_CODE_REGEX.exec(e.game_code)}return r&&r.length>1?r[1]:null},parseNSUID=function(e,t){switch(t){case exports.Region.EUROPE:return e.nsuid_txt?e.nsuid_txt[0]:null;case exports.Region.ASIA:var r=JP_NSUID_REGEX.exec(e.LinkURL[0]);return r&&r.length>0?r[0]:null;default:case exports.Region.AMERICAS:return e.nsuid}};exports.EU_DEFAULT_LOCALE=EU_DEFAULT_LOCALE,exports.EU_GAME_CHECK_CODE=EU_GAME_CHECK_CODE,exports.EU_GAME_CODE_REGEX=EU_GAME_CODE_REGEX,exports.EU_GAME_LIST_LIMIT=EU_GAME_LIST_LIMIT,exports.EU_GET_GAMES_OPTIONS=EU_GET_GAMES_OPTIONS,exports.EU_GET_GAMES_URL=EU_GET_GAMES_URL,exports.EshopError=EshopError,exports.JP_GAME_CHECK_CODE=JP_GAME_CHECK_CODE,exports.JP_GAME_CODE_REGEX=JP_GAME_CODE_REGEX,exports.JP_GET_GAMES_COMING=JP_GET_GAMES_COMING,exports.JP_GET_GAMES_CURRENT=JP_GET_GAMES_CURRENT,exports.JP_NSUID_REGEX=JP_NSUID_REGEX,exports.PRICE_GET_OPTIONS=PRICE_GET_OPTIONS,exports.PRICE_GET_URL=PRICE_GET_URL,exports.PRICE_LIST_LIMIT=PRICE_LIST_LIMIT,exports.US_ALGOLIA_ID=US_ALGOLIA_ID,exports.US_ALGOLIA_KEY=US_ALGOLIA_KEY,exports.US_GAME_CHECK_CODE=US_GAME_CHECK_CODE,exports.US_GAME_CODE_REGEX=US_GAME_CODE_REGEX,exports.US_GAME_LIST_LIMIT=US_GAME_LIST_LIMIT,exports.US_GET_GAMES_OPTIONS=US_GET_GAMES_OPTIONS,exports.US_GET_GAMES_URL=US_GET_GAMES_URL,exports.US_PRICE_RANGES=US_PRICE_RANGES,exports.default=getGamesAmerica,exports.getActiveShops=getActiveShops,exports.getGamesAmerica=getGamesAmerica,exports.getGamesEurope=getGamesEurope,exports.getGamesJapan=getGamesJapan,exports.getPrices=getPrices,exports.getShopsAmerica=getShopsAmerica,exports.getShopsAsia=getShopsAsia,exports.getShopsByCountryCodes=getShopsByCountryCodes,exports.getShopsEurope=getShopsEurope,exports.parseGameCode=parseGameCode,exports.parseNSUID=parseNSUID;
//# sourceMappingURL=index.js.map
